.<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/styles/reset.css" />
    <link rel="stylesheet" href="/styles/navbar.css" />
    <link rel="stylesheet" href="/styles/adminDashboard.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <%- include('includes/adminHeader') %>
    <div class="container">
      <h1>Admin Dashboard</h1>

      <div class="tabs">
        <button class="tab-link active" data-tab="pending-doctors">
          Pending Doctors
        </button>
        <button class="tab-link" data-tab="users">Users</button>
        <button class="tab-link" data-tab="doctors">Doctors</button>
        <button class="tab-link" data-tab="appointments">Appointments</button>
      </div>

      <div id="pending-doctors" class="tab-content active">
        <h2>Pending Doctor Approvals</h2>
        <div id="pending-doctors-list"></div>
      </div>

      <div id="users" class="tab-content">
        <h2>User Management</h2>
        <div id="users-list"></div>
      </div>

      <div id="doctors" class="tab-content">
        <h2>Doctor Management</h2>
        <div id="doctors-list"></div>
      </div>

      <div id="appointments" class="tab-content">
        <h2>Appointment Management</h2>
        <div id="appointments-list"></div>
      </div>
    </div>
    <%- include('includes/adminFooter') %>

    <script>
      function switchTab(tabId) {
        const tabButton = $(`.tab-link[data-tab="${tabId}"]`);
        if (tabButton.length) {
          tabButton.click();
        }
      }

      $(document).ready(function () {
        // Tab switching
        $(".tab-link").on("click", function () {
          const tabId = $(this).data("tab");

          $(".tab-link").removeClass("active");
          $(this).addClass("active");

          $(".tab-content").removeClass("active");
          $("#" + tabId).addClass("active");

          // Load content for the selected tab
          loadTabData(tabId);
        });

        // Load initial tab
        loadTabData("pending-doctors");

        function loadTabData(tabId) {
          switch (tabId) {
            case "pending-doctors":
              loadPendingDoctors();
              break;
            case "users":
              loadUsers();
              break;
            case "doctors":
              loadDoctors();
              break;
            case "appointments":
              loadAppointments();
              break;
          }
        }

        function loadPendingDoctors() {
          $.ajax({
            url: "/api/admin/pending-doctors",
            method: "GET",
            xhrFields: { withCredentials: true },
            success: function (data) {
              let html = "";
              if (data.length === 0) {
                html = "<p>No pending doctors to show.</p>";
              } else {
                data.forEach((doctor) => {
                  html += `
                                    <div class="doctor-card">
                                        <h3>${doctor.name}</h3>
                                        <p>Specialization: ${doctor.specialization}</p>
                                        <p>Experience: ${doctor.experience} years</p>
                                        <button class="btn approve-btn" data-id="${doctor._id}">Approve</button>
                                        <button class="btn reject-btn" data-id="${doctor._id}">Reject</button>
                                    </div>
                                `;
                });
              }
              $("#pending-doctors-list").html(html);
            },
            error: function (err) {
              $("#pending-doctors-list").html(
                '<p style="color: red;">Error loading pending doctors.</p>'
              );
            },
          });
        }

        function loadUsers() {
          $.ajax({
            url: "/api/admin/users",
            method: "GET",
            xhrFields: { withCredentials: true },
            success: function (data) {
              let html = `
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
              if (data.length > 0) {
                data.forEach((user) => {
                  html += `
                                    <tr>
                                        <td>${user.name}</td>
                                        <td>${user.email}</td>
                                        <td><button class="btn delete-btn delete-user-btn" data-id="${user._id}">Delete</button></td>
                                    </tr>
                                `;
                });
              } else {
                html += '<tr><td colspan="3">No users found.</td></tr>';
              }
              html += "</tbody></table>";
              $("#users-list").html(html);
            },
            error: function (err) {
              $("#users-list").html(
                '<p style="color: red;">Error loading users.</p>'
              );
            },
          });
        }

        function loadDoctors() {
          $.ajax({
            url: "/api/admin/doctors",
            method: "GET",
            xhrFields: { withCredentials: true },
            success: function (data) {
              let html = `
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Specialization</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
              if (data.length > 0) {
                data.forEach((doctor) => {
                  html += `
                                    <tr>
                                        <td>${doctor.name}</td>
                                        <td>${doctor.field}</td>
                                        <td><button class="btn delete-btn delete-doctor-btn" data-id="${doctor._id}">Delete</button></td>
                                    </tr>
                                `;
                });
              } else {
                html += '<tr><td colspan="3">No doctors found.</td></tr>';
              }
              html += "</tbody></table>";
              $("#doctors-list").html(html);
            },
            error: function (err) {
              $("#doctors-list").html(
                '<p style="color: red;">Error loading doctors.</p>'
              );
            },
          });
        }

        function loadAppointments() {
          $.ajax({
            url: "/api/admin/appointments",
            method: "GET",
            xhrFields: { withCredentials: true },
            success: function (data) {
              let html = `
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Doctor</th>
                                        <th>Date</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
              if (data.length > 0) {
                data.forEach((appointment) => {
                  html += `
                                    <tr>
                                        <td>${appointment.user.name}</td>
                                        <td>${appointment.doctor.name}</td>
                                        <td>${new Date(
                                          appointment.date
                                        ).toLocaleDateString()}</td>
                                        <td>${appointment.time}</td>
                                    </tr>
                                `;
                });
              } else {
                html += '<tr><td colspan="4">No appointments found.</td></tr>';
              }
              html += "</tbody></table>";
              $("#appointments-list").html(html);
            },
            error: function (err) {
              $("#appointments-list").html(
                '<p style="color: red;">Error loading appointments.</p>'
              );
            },
          });
        }

        // Action handlers
        $(document).on("click", ".approve-btn", function () {
          const id = $(this).data("id");
          $.ajax({
            url: `/api/admin/approve-doctor/${id}`,
            method: "POST",
            xhrFields: { withCredentials: true },
            success: function () {
              alert("Doctor approved");
              loadPendingDoctors();
            },
            error: function () {
              alert("Error approving doctor");
            },
          });
        });

        $(document).on("click", ".reject-btn", function () {
          const id = $(this).data("id");
          $.ajax({
            url: `/api/admin/reject-doctor/${id}`,
            method: "DELETE",
            xhrFields: { withCredentials: true },
            success: function () {
              alert("Doctor rejected");
              loadPendingDoctors();
            },
            error: function () {
              alert("Error rejecting doctor");
            },
          });
        });

        $(document).on("click", ".delete-user-btn", function () {
          const id = $(this).data("id");
          if (confirm("Are you sure you want to delete this user?")) {
            $.ajax({
              url: `/api/admin/users/${id}`,
              method: "DELETE",
              xhrFields: { withCredentials: true },
              success: function () {
                alert("User deleted");
                loadUsers();
              },
              error: function () {
                alert("Error deleting user");
              },
            });
          }
        });

        $(document).on("click", ".delete-doctor-btn", function () {
          const id = $(this).data("id");
          if (confirm("Are you sure you want to delete this doctor?")) {
            $.ajax({
              url: `/api/admin/doctors/${id}`,
              method: "DELETE",
              xhrFields: { withCredentials: true },
              success: function () {
                alert("Doctor deleted");
                loadDoctors();
              },
              error: function () {
                alert("Error deleting doctor");
              },
            });
          }
        });
      });
    </script>
  </body>
</html>
